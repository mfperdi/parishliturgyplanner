# WEBAPP_PLAN.md — Parish Liturgical Scheduler React Web App

## How to use this file
1. Each Claude session reads this file first.
2. The session prompt specifies which session number to execute.
3. Execute ONLY that session. Do not skip ahead or combine sessions.
4. Commit and push when done using the message specified in the session.

---

## Critical rules (every session)
- **Branch:** `claude/plan-sheets-crud-z59cb`
- **Do NOT modify:** `Sidebar.html`, `0_code.gs`, `0a_constants.gs`, or any existing `.gs` file
- **The only `.gs` file we create:** `0f_webapp_api.gs` (created in Session 2)
- **`0g_crud_api.gs`** is generated by `gas-react bundle` — do not hand-edit
- **All React source lives in** `web/src/`
- **`web/`** is a subdirectory with its own `package.json` and `node_modules`
- **After bundling**, two files land in project root: `index.html` and `0g_crud_api.gs`
- **GAS globals in routes:** Functions like `CRUD_getSheetData`, `triggerCalendarGeneration`, etc. are NOT imported in `server/index.js`. They are global at GAS runtime. Webpack will not resolve them — that is correct and expected. Do not add imports for them.

---

## Architecture

```
parishliturgyplanner/                     ← project root
  ├── [all existing .gs files]            ← DO NOT TOUCH
  ├── Sidebar.html                        ← DO NOT TOUCH
  ├── 0a_constants.gs                     ← DO NOT TOUCH (read for column reference only)
  ├── CLAUDE.md                           ← project conventions
  ├── WEBAPP_PLAN.md                      ← this file
  ├── 0f_webapp_api.gs                    ← NEW: Session 2
  ├── 0g_crud_api.gs                      ← NEW: generated by bundle (Session 13)
  ├── index.html                          ← NEW: generated by bundle (Session 13)
  └── web/                                ← NEW: React dev workspace
        ├── package.json                  ← modified Session 1
        ├── server/
        │     └── index.js                ← Session 3, updated Sessions 10, 12, 13
        └── src/
              ├── App.js                  ← modified Session 4
              ├── services/
              │     └── gasClient.js      ← Session 3
              ├── config/
              │     └── sheets.js         ← Session 8 (Ministries), Session 9 (rest)
              ├── pages/
              │     ├── DataPage.jsx      ← skeleton Session 4, wired Session 8, updated Session 9
              │     ├── SchedulingPage.jsx← skeleton Session 4, wired Session 11
              │     ├── ReportsPage.jsx   ← skeleton Session 4, wired Session 12
              │     └── ArchivePage.jsx   ← skeleton Session 4, wired Session 13
              └── components/
                    ├── shared/
                    │     ├── StatusMessage.jsx    ← Session 5
                    │     ├── ConfirmDialog.jsx    ← Session 5
                    │     └── MonthSelector.jsx    ← Session 5
                    ├── crud/
                    │     ├── DataTable.jsx        ← Session 7
                    │     ├── RowForm.jsx          ← Session 7
                    │     ├── SettingsForm.jsx     ← Session 9
                    │     └── fields/
                    │           └── index.jsx      ← Session 6 (all 7 field types)
                    └── scheduling/
                          ├── WorkflowStep.jsx     ← Session 11
                          └── ReviewQueue.jsx      ← Session 11
```

---

## Session 1: Scaffold

**Goal:** Create the `web/` dev workspace. Verify the build pipeline works.

**Commands to run in order:**
```bash
cd /home/user/parishliturgyplanner
mkdir -p web
cd web
npx create-react-app .
npm install gas-react
npx gas-react init
```

**Then:** Open `web/package.json`. In the `"scripts"` object, add this entry:
```json
"bundle:deploy": "react-scripts build && npx gas-react bundle && cp clasp/index.html ../index.html && cp clasp/api.js ../0g_crud_api.gs"
```

**Verify:** Run `npm run build` inside `web/`. It should succeed. (Do not run `bundle:deploy` yet — `server/index.js` does not have content yet.)

**Commit message:** `chore: scaffold React web app with gas-react`

---

## Session 2: GAS CRUD backend

**Goal:** Write the server-side functions that touch Google Sheets. One file. No UI.

**Create file:** `/home/user/parishliturgyplanner/0f_webapp_api.gs`

**Rules for this file:**
- `SpreadsheetApp` and all other GAS globals are available — no imports
- `CONSTANTS` from `0a_constants.gs` is in scope — use it for reference but column access here uses positional indices from the sheet directly
- Row indices from the client are **0-based data indices** (row 0 = first data row). Sheet API is **1-based** and row 1 is the header. Conversion: `sheetRow = dataIndex + 2`
- Wrap every function in `try/catch`. Log with `Logger.log()`. Throw descriptive errors.

**Allowlist (hardcoded array at the top of the file):**
```
['Config', 'Ministries', 'LiturgicalNotes', 'MassTemplates', 'CalendarOverrides',
 'SaintsCalendar', 'Volunteers', 'WeeklyMasses', 'MonthlyMasses', 'YearlyMasses', 'Timeoffs']
```

Every function that takes `sheetName` validates it is in this list first. Throw if not.

**Functions:**

```
function CRUD_getSheetData(sheetName)
  - Validate allowlist
  - sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(sheetName)
  - allValues = sheet.getDataRange().getValues()
  - headers = allValues[0]
  - rows = allValues.slice(1), filtered to remove rows where every cell is empty string or blank
  - return { headers, rows }

function CRUD_addRow(sheetName, rowData)
  - Validate allowlist
  - rowData is an array of values in column order
  - lastRow = sheet.getLastRow()
  - sheet.getRange(lastRow + 1, 1, 1, rowData.length).setValues([rowData])
  - return { success: true, rowIndex: lastRow - 1 }
    (lastRow - 1 because: lastRow is 1-based sheet row of the row we just wrote,
     subtract 1 for header, subtract 0 because it IS the new data row. Net: lastRow - 1)

function CRUD_updateRow(sheetName, rowIndex, rowData)
  - Validate allowlist
  - sheetRow = rowIndex + 2
  - sheet.getRange(sheetRow, 1, 1, rowData.length).setValues([rowData])
  - return { success: true }

function CRUD_deleteRow(sheetName, rowIndex)
  - Validate allowlist
  - sheetRow = rowIndex + 2
  - sheet.deleteRows(sheetRow, 1)
  - return { success: true }

function CRUD_getAllowedSheets()
  - return { sheets: <the allowlist array> }
```

**Timeoff review functions (same file):**

```
function WEBAPP_getPendingTimeoffs(monthString)
  - monthString format: "2026-02"
  - Call TIMEOFFS_getPendingRequests() — this is a global function from 4_timeoff-form.gs
  - It returns an array of objects: { rowNumber, timestamp, name, type, selectedDates, volunteerNotes, reviewNotes }
  - rowNumber from that function is the 1-based sheet row. Convert to 0-based data index: dataIndex = rowNumber - 2
  - Add dataIndex to each object before returning
  - Filter: only include requests where the month field matches.
    The month in the timeoff data is like "February 2026". Convert monthString "2026-02" to that format for comparison.
  - return { pending: <filtered array with dataIndex added>, totalCount: pending.length }

function WEBAPP_approveTimeoff(rowIndex, notes)
  - sheetRow = rowIndex + 2
  - sheet = Timeoffs sheet
  - sheet.getRange(sheetRow, 7).setValue('Approved')           // STATUS column
  - sheet.getRange(sheetRow, 8).setValue(new Date())           // REVIEWED_DATE column
  - if notes is not empty: sheet.getRange(sheetRow, 9).setValue(notes)  // REVIEW_NOTES column
  - return { success: true }

function WEBAPP_rejectTimeoff(rowIndex, notes)
  - Same as approve but setValue('Rejected') for STATUS
  - return { success: true }
```

**Commit message:** `feat: add CRUD and timeoff review server functions`

---

## Session 3: Routes + gas client

**Goal:** Wire up client-server communication. Two small files.

**Create file:** `/home/user/parishliturgyplanner/web/server/index.js`

```javascript
import { server } from 'gas-react';

// ─── CRUD ─────────────────────────────────────────────────────────────────────
server.on('getSheetData',     (req) => CRUD_getSheetData(req.body.sheetName));
server.on('addRow',           (req) => CRUD_addRow(req.body.sheetName, req.body.rowData));
server.on('updateRow',        (req) => CRUD_updateRow(req.body.sheetName, req.body.rowIndex, req.body.rowData));
server.on('deleteRow',        (req) => CRUD_deleteRow(req.body.sheetName, req.body.rowIndex));
server.on('getAllowedSheets', ()    => CRUD_getAllowedSheets());

// ─── SCHEDULING ───────────────────────────────────────────────────────────────
// Added in Session 10

// ─── REPORTS ──────────────────────────────────────────────────────────────────
// Added in Session 12

// ─── ARCHIVE ──────────────────────────────────────────────────────────────────
// Added in Session 13
```

**Create file:** `/home/user/parishliturgyplanner/web/src/services/gasClient.js`

```javascript
import { client } from 'gas-react';

/**
 * Calls a server route and returns a promise.
 * @param {string} route - The route name registered via server.on()
 * @param {object} body  - The payload (becomes req.body on the server)
 * @returns {Promise<any>} The value returned by the route handler
 */
export default function gasClient(route, body = {}) {
  return client.send(route, body);
}
```

**Commit message:** `feat: add routes and gas client service`

---

## Session 4: App shell + page skeletons

**Goal:** The app builds, renders 4 tabs, clicking switches content. No real logic yet.

**Modify:** `/home/user/parishliturgyplanner/web/src/App.js`
- Delete all existing CRA content (the logo import, CSS import, the demo JSX)
- Use state-based routing — no react-router dependency needed for 4 tabs:
  ```javascript
  const [activePage, setActivePage] = useState('data');
  ```
- Render a top nav bar with 4 tab buttons: `Data`, `Scheduling`, `Reports`, `Archive`
- Each button sets `activePage` to `'data'`, `'scheduling'`, `'reports'`, `'archive'`
- Active tab gets a highlighted style (e.g., border-bottom or background color)
- Below the nav: render the matching page component based on `activePage`
- Import the 4 page components
- Inline CSS (no external framework). Nav bar: white background, subtle bottom border, tabs in a row. Content area: some padding.

**Create 4 skeleton pages** (each ~10-15 lines):

`src/pages/DataPage.jsx`:
```jsx
export default function DataPage() {
  return <div><h2>Data</h2><p>Sheet management goes here.</p></div>;
}
```

`src/pages/SchedulingPage.jsx`:
```jsx
export default function SchedulingPage() {
  return <div><h2>Scheduling</h2><p>Workflow steps go here.</p></div>;
}
```

`src/pages/ReportsPage.jsx`:
```jsx
export default function ReportsPage() {
  return <div><h2>Reports</h2><p>Reports and exports go here.</p></div>;
}
```

`src/pages/ArchivePage.jsx`:
```jsx
export default function ArchivePage() {
  return <div><h2>Archive</h2><p>Archive actions go here.</p></div>;
}
```

**Verify:** `npm run build` succeeds. Nav renders. Tabs switch content.

**Commit message:** `feat: add app shell with 4-tab navigation`

---

## Session 5: Shared components

**Goal:** Three reusable components used across all pages. Not wired to anything yet.

**Create 3 files in `src/components/shared/`:**

### StatusMessage.jsx
Props: `{ status, message, onDismiss }`
- `status`: `'idle'` | `'loading'` | `'success'` | `'error'`
- When `idle`: render nothing (return null)
- When `loading`: a blue bar with a spinner indicator and text "Working..."
- When `success`: a green bar with the message text + a dismiss (×) button. Auto-dismisses after 5 seconds via `useEffect` + `setTimeout`.
- When `error`: a red bar with the message text + a dismiss (×) button. Does NOT auto-dismiss.
- `onDismiss` is called when the user clicks × or when auto-dismiss fires. The parent sets status back to `'idle'`.
- Style: fixed-width bar across the top of whatever container it's in. Rounded corners. Readable font.

### ConfirmDialog.jsx
Props: `{ isOpen, title, message, confirmLabel, onConfirm, onCancel }`
- When `isOpen` is false: render nothing
- When `isOpen` is true: render a modal
  - Dark semi-transparent overlay covering the viewport
  - White dialog box centered on screen (max-width 400px)
  - `title` as a heading
  - `message` as body text
  - Two buttons at the bottom: `confirmLabel` (default: `"Confirm"`) and `"Cancel"`
  - The confirm button is styled red (it's always used for destructive actions)
  - Cancel button is styled grey/neutral
  - Clicking overlay background calls `onCancel`

### MonthSelector.jsx
Props: `{ value, onChange, months }`
- `months`: array of `{ value: "2026-02", display: "February 2026" }`
- Renders a `<select>` with a default disabled option "Select a month..."
- Each month in the array becomes an `<option>`
- Calls `onChange(selectedValue)` on change
- If `months` is empty or undefined, shows "No months available" as the only option (disabled)

**Commit message:** `feat: add shared UI components`

---

## Session 6: Field components

**Goal:** All 7 form field types in one file. These are the building blocks of RowForm (Session 7).

**Create file:** `src/components/crud/fields/index.jsx`

**Shared props interface (all components receive these):**
- `label` (string) — rendered as a `<label>` above the input
- `value` — current value of the field
- `onChange(newValue)` — called when value changes
- `error` (string or null) — if set, rendered in red below the input
- `disabled` (boolean) — if true, input is non-interactive

**Each component's layout:** label on top, input below label, error text below input (if present). Consistent spacing and styling.

### TextField
- Renders `<input type="text">`
- value is a string

### TextareaField
- Renders `<textarea rows={3}>`
- value is a string

### ToggleField
- Renders a styled checkbox toggle (not a raw checkbox — style it as a pill-shaped toggle switch)
- value is a boolean
- Label is rendered, and clicking the toggle flips the value

### SelectField
- Extra prop: `options` (array of strings)
- Renders `<select>` with a blank default option ("—")
- Each option string becomes an `<option>`
- value is a string

### MultiselectField
- Extra prop: `options` (array of strings)
- Value is a **comma-separated string** (e.g., `"1st reading, 2nd reading"`) — this matches how the data is stored in Google Sheets
- Renders selected values as removable tags (each tag has an ×)
- Below the tags: a small dropdown (or text input with filtered suggestions) showing available options not yet selected
- Clicking an option adds it. Clicking × on a tag removes it.
- Calls onChange with the updated comma-separated string

### DateField
- Renders `<input type="date">`
- value is a date string in `YYYY-MM-DD` format
- Note: Google Sheets stores dates as Date objects which come back as strings. Handle both formats gracefully.

### TimeField
- Renders `<input type="time">`
- value is a time string in `HH:MM` format (24-hour)

**Export each as a named export.** Also export a default map object for easy lookup by type string:
```javascript
export const FIELD_COMPONENTS = {
  text: TextField,
  textarea: TextareaField,
  toggle: ToggleField,
  select: SelectField,
  multiselect: MultiselectField,
  date: DateField,
  time: TimeField,
};
```

**Commit message:** `feat: add form field components`

---

## Session 7: DataTable + RowForm

**Goal:** The two core CRUD layout components. Not connected to data yet — Session 8 does that.

**Create file:** `src/components/crud/DataTable.jsx`

Props:
- `columns` — array of column config objects (shape defined in Session 8's sheets.js)
- `rows` — array of arrays. Each inner array = one row's values in column order.
- `onEdit(rowIndex)` — called when Edit is clicked on a row
- `onDelete(rowIndex)` — called when Delete is clicked on a row

Renders:
- A responsive `<table>`
- `<thead>`: one `<th>` per column using `column.label`. Plus a final `<th>` with no label (for the action buttons column).
- `<tbody>`: one `<tr>` per row. Each cell displays the value. For boolean values (toggle columns), display "Yes" or "No". For long text, truncate at 40 characters with ellipsis.
- Each row's action column: two small buttons — `Edit` and `Delete`.
- If `rows` is empty: render a single row spanning all columns with text "No data. Click Add to create the first entry."

**Create file:** `src/components/crud/RowForm.jsx`

Props:
- `columns` — same column config array
- `initialValues` — array of current values (one per column). `null` for a new row.
- `onSave(valuesArray)` — called with the complete row values array
- `onCancel()` — called when Cancel is clicked
- `isNew` (boolean) — true = adding a row, false = editing

Renders:
- A form container (not a `<form>` tag — use a div, handle submit manually)
- One field per column, in order. For each column:
  - If `column.type === 'readonly'` AND `isNew`: skip this field entirely (readonly fields like Full Name don't exist yet on a new row)
  - If `column.type === 'readonly'` AND NOT `isNew`: render the value as static text (not an input)
  - Otherwise: render the appropriate field component from `FIELD_COMPONENTS[column.type]`
    - Pass `options={column.options}` if present (for select/multiselect)
    - Pass `value={currentValues[columnIndex]}`
    - Pass `onChange` that updates that index in local state
    - Pass `error` from validation state (if any)
    - Pass `disabled={false}`
- **Validation on Save:** Before calling `onSave`, check every column where `column.required === true`. If that column's value is empty/blank/null, set an error on that field and do NOT call onSave. Show errors inline on the fields.
- **Computed fields:** If `column.computed === true`, the value is auto-set. For Volunteers Full Name: set it to `firstName + " " + lastName` before passing to onSave. (This is the only computed field in the current schema.)
- Two buttons at the bottom: `Save` (calls validation then onSave) and `Cancel` (calls onCancel)
- Save button label: "Add" if `isNew`, "Save" if not

**Commit message:** `feat: add DataTable and RowForm components`

---

## Session 8: First sheet live — Ministries

**Goal:** Ministries CRUD works end-to-end. This is the integration session — everything connects for the first time. Budget time for debugging.

**Create file:** `src/config/sheets.js`

Start with Ministries only:

```javascript
export const SHEETS = {
  ministries: {
    id: 'Ministries',
    label: 'Ministries',
    view: 'table',
    columns: [
      { key: 'ministryName',  label: 'Ministry',    type: 'text',   required: true },
      { key: 'roleName',      label: 'Role',        type: 'text',   required: true },
      { key: 'description',   label: 'Description', type: 'textarea' },
      { key: 'isActive',      label: 'Active',      type: 'toggle', default: true },
    ]
  }
};

export const SHEET_ORDER = ['ministries'];
```

**Rewrite:** `src/pages/DataPage.jsx` — replace the skeleton with the full implementation:

```
State:
  activeSheet     — key from SHEET_ORDER (default: first entry)
  rows            — array of row arrays (from getSheetData)
  status          — 'idle' | 'loading' | 'success' | 'error'
  statusMessage   — string
  formOpen        — boolean
  editingIndex    — number or null (null = new row)
  deleteConfirm   — { open: boolean, rowIndex: number | null }
  options         — object mapping column keys to arrays of option strings (for optionsFrom columns)

On mount and when activeSheet changes:
  1. Set status to 'loading'
  2. Call gasClient('getSheetData', { sheetName: sheetConfig.id })
  3. On success: set rows, set status to 'success', set statusMessage
  4. On error: set status to 'error', set statusMessage to error
  5. For any column with optionsFrom: also call gasClient('getSheetData', { sheetName: column.optionsFrom.sheet })
     and extract unique values from column index column.optionsFrom.column into the options state

Render:
  - Sheet selector: if SHEET_ORDER has more than one entry, render tabs or a dropdown to switch sheets
    (Right now it's just Ministries, so this can be a simple label. Session 9 will make it a real selector.)
  - StatusMessage component (bound to status/statusMessage state)
  - If formOpen is false: render DataTable + an "Add" button
    - DataTable receives columns, rows, onEdit, onDelete callbacks
    - onEdit(i): set formOpen=true, editingIndex=i
    - onDelete(i): set deleteConfirm={ open: true, rowIndex: i }
  - If formOpen is true: render RowForm
    - initialValues: editingIndex !== null ? rows[editingIndex] : null
    - isNew: editingIndex === null
    - Pass columns, but inject the resolved options into each column (merge column.options with fetched options)
    - onSave(valuesArray):
        if isNew: call gasClient('addRow', { sheetName, rowData: valuesArray })
        else: call gasClient('updateRow', { sheetName, rowIndex: editingIndex, rowData: valuesArray })
        on success: re-fetch rows, close form
    - onCancel: close form
  - ConfirmDialog for delete (bound to deleteConfirm state)
    - onConfirm: call gasClient('deleteRow', { sheetName, rowIndex: deleteConfirm.rowIndex })
      on success: re-fetch rows, close confirm
    - onCancel: close confirm
```

**Build + test.** This is the first time React talks to the server. Likely places for bugs:
- gas-react client/server wiring
- Row index conversion (0-based vs 1-based)
- Toggle values (Sheets stores TRUE/FALSE, React uses true/false — verify conversion)

**Commit message:** `feat: Ministries CRUD live end-to-end`

---

## Session 9: Remaining CRUD sheets

**Goal:** Add the other 9 sheets. Add SettingsForm for the Config sheet.

**Update:** `src/config/sheets.js` — add these to the SHEETS object. Update SHEET_ORDER to:
```javascript
export const SHEET_ORDER = [
  'ministries', 'liturgicalNotes', 'config', 'massTemplates',
  'calendarOverrides', 'saintsCalendar', 'volunteers',
  'weeklyMasses', 'monthlyMasses', 'yearlyMasses'
];
```

**Sheet configs to add:**

```javascript
  liturgicalNotes: {
    id: 'LiturgicalNotes',
    label: 'Liturgical Notes',
    view: 'table',
    columns: [
      { key: 'celebration', label: 'Celebration', type: 'text',     required: true },
      { key: 'notes',       label: 'Notes',       type: 'textarea' },
    ]
  },

  config: {
    id: 'Config',
    label: 'Config',
    view: 'settings',
    columns: [
      { key: 'setting', label: 'Setting', type: 'readonly' },
      { key: 'value',   label: 'Value',   type: 'text' },
    ]
  },

  massTemplates: {
    id: 'MassTemplates',
    label: 'Mass Templates',
    view: 'table',
    columns: [
      { key: 'templateName', label: 'Template',    type: 'text',        required: true },
      { key: 'description',  label: 'Description', type: 'textarea' },
      { key: 'roles',        label: 'Roles',       type: 'multiselect', optionsFrom: { sheet: 'Ministries', column: 1 } },
    ]
  },

  calendarOverrides: {
    id: 'CalendarOverrides',
    label: 'Calendar Overrides',
    view: 'table',
    columns: [
      { key: 'month',                 label: 'Month',       type: 'select',  options: ['1','2','3','4','5','6','7','8','9','10','11','12'], required: true },
      { key: 'day',                   label: 'Day',         type: 'select',  options: ['1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'], required: true },
      { key: 'liturgicalCelebration', label: 'Celebration', type: 'text',    required: true },
      { key: 'rank',                  label: 'Rank',        type: 'select',  options: ['Solemnity','Feast','Sunday','Memorial','Optional Memorial','Weekday'], required: true },
      { key: 'color',                 label: 'Color',       type: 'select',  options: ['White','Violet','Rose','Green','Red','Gold','Blue','Black'], required: true },
      { key: 'calendar',              label: 'Calendar',    type: 'select',  options: ['General Roman Calendar','USA','Parish'], required: true },
      { key: 'notes',                 label: 'Notes',       type: 'textarea' },
    ]
  },

  saintsCalendar: {
    id: 'SaintsCalendar',
    label: 'Saints Calendar',
    view: 'table',
    columns: [
      { key: 'month',                 label: 'Month',       type: 'select',  options: ['1','2','3','4','5','6','7','8','9','10','11','12'], required: true },
      { key: 'day',                   label: 'Day',         type: 'select',  options: ['1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'], required: true },
      { key: 'liturgicalCelebration', label: 'Celebration', type: 'text',    required: true },
      { key: 'rank',                  label: 'Rank',        type: 'select',  options: ['Solemnity','Feast','Sunday','Memorial','Optional Memorial','Weekday'], required: true },
      { key: 'color',                 label: 'Color',       type: 'select',  options: ['White','Violet','Rose','Green','Red','Gold','Blue','Black'], required: true },
      { key: 'calendar',              label: 'Calendar',    type: 'select',  options: ['General Roman Calendar','USA','Parish'], required: true },
    ]
  },

  volunteers: {
    id: 'Volunteers',
    label: 'Volunteers',
    view: 'table',
    columns: [
      { key: 'volunteerId',        label: 'ID',                  type: 'text',        required: true },
      { key: 'firstName',          label: 'First Name',          type: 'text',        required: true },
      { key: 'lastName',           label: 'Last Name',           type: 'text',        required: true },
      { key: 'fullName',           label: 'Full Name',           type: 'readonly',    computed: true },
      { key: 'email',              label: 'Email',               type: 'text',        required: true },
      { key: 'phone',              label: 'Phone',               type: 'text' },
      { key: 'parentGuardian',     label: 'Parent/Guardian',     type: 'text' },
      { key: 'familyTeam',         label: 'Family Team',         type: 'text' },
      { key: 'status',             label: 'Status',              type: 'select',      options: ['Active','Inactive','Substitute Only','Ministry Sponsor','Parent/Guardian'], required: true },
      { key: 'ministries',         label: 'Ministries',          type: 'multiselect', optionsFrom: { sheet: 'Ministries', column: 0 } },
      { key: 'roles',              label: 'Roles',               type: 'multiselect', optionsFrom: { sheet: 'Ministries', column: 1 } },
      { key: 'preferredMassTime',  label: 'Preferred Mass Time', type: 'multiselect', optionsFrom: { sheet: 'WeeklyMasses', column: 0, also: ['MonthlyMasses', 'YearlyMasses'] } },
      { key: 'dateCleared',        label: 'Date Cleared',        type: 'date' },
      { key: 'dateTrained',        label: 'Date Trained',        type: 'date' },
    ]
  },

  weeklyMasses: {
    id: 'WeeklyMasses',
    label: 'Weekly Masses',
    view: 'table',
    columns: [
      { key: 'eventId',       label: 'Event ID',     type: 'text',     required: true },
      { key: 'dayOfWeek',     label: 'Day',          type: 'select',   options: ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'], required: true },
      { key: 'time',          label: 'Time',         type: 'time',     required: true },
      { key: 'startDate',     label: 'Start Date',   type: 'date' },
      { key: 'endDate',       label: 'End Date',     type: 'date' },
      { key: 'isActive',      label: 'Active',       type: 'toggle',   default: true },
      { key: 'isAnticipated', label: 'Anticipated',  type: 'toggle',   default: false },
      { key: 'description',   label: 'Description',  type: 'text' },
      { key: 'templateName',  label: 'Template',     type: 'select',   optionsFrom: { sheet: 'MassTemplates', column: 0 }, required: true },
      { key: 'assignedGroup', label: 'Group',        type: 'text' },
      { key: 'notes',         label: 'Notes',        type: 'textarea' },
    ]
  },

  monthlyMasses: {
    id: 'MonthlyMasses',
    label: 'Monthly Masses',
    view: 'table',
    columns: [
      { key: 'eventId',       label: 'Event ID',      type: 'text',     required: true },
      { key: 'weekOfMonth',   label: 'Week',          type: 'select',   options: ['1st','2nd','3rd','4th','5th','Last'], required: true },
      { key: 'dayOfWeek',     label: 'Day',           type: 'select',   options: ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'], required: true },
      { key: 'time',          label: 'Time',          type: 'time',     required: true },
      { key: 'startDate',     label: 'Start Date',    type: 'date' },
      { key: 'endDate',       label: 'End Date',      type: 'date' },
      { key: 'isActive',      label: 'Active',        type: 'toggle',   default: true },
      { key: 'isAnticipated', label: 'Anticipated',   type: 'toggle',   default: false },
      { key: 'overrideType',  label: 'Override',      type: 'select',   options: ['append','overrideday'] },
      { key: 'description',   label: 'Description',   type: 'text' },
      { key: 'templateName',  label: 'Template',      type: 'select',   optionsFrom: { sheet: 'MassTemplates', column: 0 }, required: true },
      { key: 'assignedGroup', label: 'Group',         type: 'text' },
      { key: 'notes',         label: 'Notes',         type: 'textarea' },
    ]
  },

  yearlyMasses: {
    id: 'YearlyMasses',
    label: 'Yearly Masses',
    view: 'table',
    columns: [
      { key: 'eventId',              label: 'Event ID',       type: 'text',     required: true },
      { key: 'date',                 label: 'Date',           type: 'date',     required: true },
      { key: 'liturgicalCelebration',label: 'Celebration',    type: 'text' },
      { key: 'time',                 label: 'Time',           type: 'time',     required: true },
      { key: 'isActive',             label: 'Active',         type: 'toggle',   default: true },
      { key: 'isAnticipated',        label: 'Anticipated',    type: 'toggle',   default: false },
      { key: 'overrideType',         label: 'Override',       type: 'select',   options: ['append','override'] },
      { key: 'description',          label: 'Description',    type: 'text' },
      { key: 'templateName',         label: 'Template',       type: 'select',   optionsFrom: { sheet: 'MassTemplates', column: 0 }, required: true },
      { key: 'assignedGroup',        label: 'Group',          type: 'text' },
      { key: 'notes',                label: 'Notes',          type: 'textarea' },
    ]
  },
```

**Create file:** `src/components/crud/SettingsForm.jsx`

Props: `{ columns, rows, onSave(rowIndex, valuesArray) }`
- `rows` is the full data from the Config sheet (array of [setting, value] pairs)
- Renders a vertical list — NOT a table
- Each row renders as: setting name (left, bold, not editable) + value input (right, text field)
- Local state tracks which values have changed from their original
- A single "Save Changes" button at the bottom. Disabled if nothing changed.
- On click: calls `onSave(rowIndex, [setting, newValue])` for each row that changed

**Update:** `src/pages/DataPage.jsx`
- Add a sheet selector: render tab buttons for each entry in SHEET_ORDER using the sheet's `label`
- When `activeSheet` changes, fetch that sheet's data
- When rendering: if `sheetConfig.view === 'settings'`, render `SettingsForm` instead of `DataTable`/`RowForm`
- The `optionsFrom` fetching logic (from Session 8) now also handles the `also` property:
  - If a column has `optionsFrom.also` (array of extra sheet names), fetch those too and merge the values from the same column index

**Commit message:** `feat: add remaining 9 CRUD sheets and settings form`

---

## Session 10: Scheduling backend + routes

**Goal:** Add the workflow routes. The GAS functions already exist (Session 2 added the WEBAPP_* ones; the rest are existing globals). This session only touches `server/index.js`.

**Update:** `web/server/index.js` — add the scheduling block (replace the `// Added in Session 10` comment):

```javascript
// ─── SCHEDULING ───────────────────────────────────────────────────────────────
server.on('getMonths',           ()    => getMonthsForSidebar());
server.on('generateCalendar',   ()    => triggerCalendarGeneration());
server.on('validateData',       ()    => VALIDATE_all());
server.on('generateSchedule',   (req) => triggerScheduleGeneration(req.body.monthString));
server.on('updateTimeoffForm',  (req) => TIMEOFFS_updateFormForMonth(req.body.monthString));
server.on('getPendingTimeoffs', (req) => WEBAPP_getPendingTimeoffs(req.body.monthString));
server.on('approveTimeoff',     (req) => WEBAPP_approveTimeoff(req.body.rowIndex, req.body.notes));
server.on('rejectTimeoff',      (req) => WEBAPP_rejectTimeoff(req.body.rowIndex, req.body.notes));
server.on('bulkApproveClean',   ()    => TIMEOFFS_bulkApprovePending());
server.on('autoAssign',         (req) => triggerAssignment(req.body.monthString));
```

All functions on the right side are globals at GAS runtime. Do not import them.

**Commit message:** `feat: add scheduling workflow routes`

---

## Session 11: Scheduling page

**Goal:** The scheduling pipeline is live. 6 steps, progress indicators, timeoff review queue.

**Create file:** `src/components/scheduling/WorkflowStep.jsx`

Props: `{ number, title, description, status, action, actionLabel, actionDisabled, children }`
- `status`: `'pending'` | `'active'` | `'complete'` | `'error'`
- Renders a card/panel:
  - Left side: a circular badge with the step `number`. Color by status: pending=grey, active=blue, complete=green, error=red.
  - Right side: `title` (bold), `description` (muted text)
  - If `action` is provided: an action button labeled `actionLabel`. Disabled if `actionDisabled` is true.
  - `children` render below the button (used for inline content like the review queue)
- Clicking the action button calls `action()`

**Create file:** `src/components/scheduling/ReviewQueue.jsx`

Props: `{ monthString }`
- On mount (and when monthString changes): call `gasClient('getPendingTimeoffs', { monthString })`
- State: `pending` (array), `loading`, `error`
- If loading: show spinner
- If error: show error message
- If pending is empty: show "No pending timeoff requests for this month."
- Otherwise render the list:
  - A header row showing: count of pending requests + a "Bulk Approve Clean" button
  - Each pending request as a card/row showing:
    - Volunteer Name (bold)
    - Type (blacklist or whitelist label)
    - Selected Dates
    - Month
    - Volunteer Notes (if present)
    - Review Notes / warnings (if present, styled yellow)
    - Two action buttons: green "Approve" and red "Reject"
  - Approve: calls `gasClient('approveTimeoff', { rowIndex: item.dataIndex, notes: '' })`, then re-fetches list
  - Reject: shows a small inline text input for notes (appears on click). A "Confirm Reject" button submits it via `gasClient('rejectTimeoff', { rowIndex: item.dataIndex, notes })`. A cancel link hides the input.
  - Bulk Approve: calls `gasClient('bulkApproveClean')`, then re-fetches list

**Rewrite:** `src/pages/SchedulingPage.jsx` — replace skeleton:

```
State:
  selectedMonth     — string (e.g. "2026-02") or null
  months            — array from getMonths (fetched on mount)
  stepStatuses      — object { step1: 'pending', step2: 'pending', ... } (tracks completion this session)
  status / message  — for StatusMessage

On mount: call gasClient('getMonths') → set months

Render:
  - StatusMessage (bound to status/message)
  - MonthSelector at top (value=selectedMonth, months=months, onChange sets selectedMonth)
  - 6 WorkflowStep components:

  Step 1 — Generate Calendar
    title: "Generate Calendar"
    description: "Generates the liturgical calendar for the configured year. Run once per year."
    status: stepStatuses.step1
    actionLabel: "Generate Calendar"
    action: opens ConfirmDialog ("This will regenerate the entire calendar. Continue?")
            on confirm: gasClient('generateCalendar')
            on success: set stepStatuses.step1 = 'complete', set status='success'
            on error: set stepStatuses.step1 = 'error'
    actionDisabled: false (no month needed)

  Step 2 — Validate Data
    title: "Validate Data"
    description: "Checks all sheets for errors and warnings before scheduling."
    status: stepStatuses.step2
    actionLabel: "Validate"
    action: gasClient('validateData')
            on success: set stepStatuses.step2 = 'complete', render results inline as children
            Results format: the response from VALIDATE_all() is an object with errors and warnings arrays. Render grouped by category.
    actionDisabled: false

  Step 3 — Generate Schedule
    title: "Generate Schedule"
    description: "Creates the ministry assignment slots for the selected month. Clears any existing assignments."
    status: stepStatuses.step3
    actionLabel: "Generate Schedule"
    action: opens ConfirmDialog ("This will clear and regenerate assignments for [month]. Continue?")
            on confirm: gasClient('generateSchedule', { monthString: selectedMonth })
            on success: set stepStatuses.step3 = 'complete'
    actionDisabled: selectedMonth === null

  Step 4 — Update Timeoff Form
    title: "Update Timeoff Form"
    description: "Populates the Google Form with this month's mass dates for volunteer submissions."
    status: stepStatuses.step4
    actionLabel: "Update Form"
    action: gasClient('updateTimeoffForm', { monthString: selectedMonth })
            on success: set stepStatuses.step4 = 'complete'
    actionDisabled: selectedMonth === null

  Step 5 — Review Timeoffs
    title: "Review Timeoffs"
    description: "Review and approve/reject pending timeoff requests."
    status: stepStatuses.step5 (set to 'complete' when pending count reaches 0)
    actionDisabled: selectedMonth === null
    NO action button on this step — instead, children = <ReviewQueue monthString={selectedMonth} />
    (ReviewQueue only renders when selectedMonth is not null)

  Step 6 — Auto-Assign Volunteers
    title: "Auto-Assign Volunteers"
    description: "Automatically assigns qualified volunteers to open ministry roles."
    status: stepStatuses.step6
    actionLabel: "Auto-Assign"
    action: gasClient('autoAssign', { monthString: selectedMonth })
            on success: set stepStatuses.step6 = 'complete'
    actionDisabled: selectedMonth === null
```

**Commit message:** `feat: add scheduling workflow page`

---

## Session 12: Reports page + routes

**Goal:** All 5 report panels are live.

**Update:** `web/server/index.js` — add the reports block (replace the `// Added in Session 12` comment):

```javascript
// ─── REPORTS ──────────────────────────────────────────────────────────────────
server.on('getActiveMinistries',    ()    => getActiveMinistries());
server.on('getNext12Months',        ()    => getNext12Months());
server.on('getMonthlyViewStatus',   ()    => getCurrentMonthlyViewStatus());
server.on('setMonthlyViewFilter',   (req) => setMonthlyViewMinistryFilter(req.body.ministry));
server.on('regenerateViews',        ()    => regenerateMonthlyViewsManually());
server.on('generateCustomPrint',    (req) => generateCustomPrint(req.body.monthString, req.body.ministry, req.body.sheetName));
server.on('getWeeklyEmailText',     ()    => getScheduleForEmailCopy({}));
server.on('generateDashboard',      (req) => DASHBOARD_generateSimplified(req.body.monthString));
server.on('publishAll',             (req) => PUBLISH_publishAllMinistries(req.body.monthString));
server.on('publishMinistry',        (req) => PUBLISH_syncMonthlyViewToPublic(req.body.monthString, { ministryFilter: [req.body.ministry] }));
server.on('getAutoPublishStatus',   ()    => AUTOPUBLISH_getStatus());
server.on('enableAutoPublish',      ()    => AUTOPUBLISH_setupTrigger(30));
server.on('disableAutoPublish',     ()    => AUTOPUBLISH_removeTrigger());
```

**Rewrite:** `src/pages/ReportsPage.jsx` — replace skeleton with 5 panels (sections on the page, each with its own heading and controls):

**Panel 1: Monthly Views**
- On mount: fetch status via `gasClient('getMonthlyViewStatus')` and ministries via `gasClient('getActiveMinistries')`
- Display: current month view name + status, next month view name + status, current ministry filter
- Controls:
  - Ministry dropdown (options: "All Ministries" + fetched ministries). On change: calls `gasClient('setMonthlyViewFilter', { ministry })`
  - "Regenerate Views" button: calls `gasClient('regenerateViews')`

**Panel 2: Custom Print**
- On mount: fetch ministries via `gasClient('getActiveMinistries')` and months via `gasClient('getNext12Months')`
- Controls:
  - Month dropdown (from getNext12Months)
  - Ministry dropdown ("All Ministries" + fetched ministries)
  - Sheet name text input. Auto-suggest logic: when ministry changes or month changes, suggest a name:
    - If ministry is "All Ministries": suggest "Monthly Schedule"
    - If ministry is specific: suggest "[Ministry] Schedule"
  - "Generate" button: calls `gasClient('generateCustomPrint', { monthString, ministry, sheetName })`

**Panel 3: Weekly Email**
- Controls:
  - "Generate" button: calls `gasClient('getWeeklyEmailText')`
  - On success: renders the response text in a read-only `<textarea>` (large, ~10 rows). Shows the weekString as a label above it (e.g., "Schedule for Feb 2–8, 2026").
  - "Copy to Clipboard" button: copies the textarea content. Shows brief "Copied!" feedback.

**Panel 4: Dashboard**
- On mount: fetch months via `gasClient('getNext12Months')`
- Controls:
  - Month dropdown
  - "Generate Dashboard" button: calls `gasClient('generateDashboard', { monthString })`
  - On success: show success message (the dashboard is generated as a sheet in the spreadsheet)

**Panel 5: Publish**
- On mount: fetch status via `gasClient('getAutoPublishStatus')` and ministries via `gasClient('getActiveMinistries')` and months via `gasClient('getNext12Months')`
- Sub-section A: Publish All
  - Month dropdown
  - "Publish All" button: calls `gasClient('publishAll', { monthString })`
- Sub-section B: Publish Individual
  - Month dropdown + Ministry dropdown
  - "Publish" button: calls `gasClient('publishMinistry', { monthString, ministry })`
- Sub-section C: Auto-Publish
  - Shows current status: enabled/disabled, interval if enabled
  - If disabled: "Enable Auto-Publish" button → calls `gasClient('enableAutoPublish')`
  - If enabled: "Disable Auto-Publish" button → calls `gasClient('disableAutoPublish')`
  - Re-fetch status after toggle

**Commit message:** `feat: add reports page with all panels`

---

## Session 13: Archive page + routes + final bundle

**Goal:** Archive page is live. Final bundle produces the deployable output.

**Update:** `web/server/index.js` — add the archive block (replace the `// Added in Session 13` comment):

```javascript
// ─── ARCHIVE ──────────────────────────────────────────────────────────────────
server.on('archiveYear',   (req) => ARCHIVE_createArchiveFile(req.body.year));
server.on('listArchives',  ()    => ARCHIVE_listArchives());
server.on('clearOldData',  (req) => ARCHIVE_clearOldData(req.body.sheetsToRestart));
```

Note: These call the CORE archive functions directly (not the `ARCHIVE_prompt*` wrappers). The core functions return data; the prompt wrappers show GAS dialogs. We want the data.

**Rewrite:** `src/pages/ArchivePage.jsx` — replace skeleton with 3 sections:

**Section 1: Archive Current Year**
- Gets current year: `new Date().getFullYear()`
- Displays: "Archive [YYYY]" heading + explanation text
- "Archive Year [YYYY]" button → opens ConfirmDialog:
  - title: "Archive Current Year"
  - message: "This will create an archive copy of LiturgicalCalendar, Assignments, and Timeoffs for [YYYY]. The originals will not be deleted."
  - confirmLabel: "Create Archive"
- On confirm: calls `gasClient('archiveYear', { year })`
- On success: response has `{ success, fileName, url, message }`. Show the file name and a clickable link to the archive spreadsheet (the url).

**Section 2: View Archives**
- On mount: calls `gasClient('listArchives')`
- If result is empty array: "No archives yet."
- Otherwise: render a list. Each item shows: name, year, a link to open it (using the url from the response).

**Section 3: Clear Old Data**
- "Clear Old Data" button → opens ConfirmDialog:
  - title: "Clear Old Data"
  - message: "This will clear LiturgicalCalendar, Assignments, and Timeoffs sheets and reset them to empty (headers only). Make sure you have archived first."
  - confirmLabel: "Clear Data"
- On confirm: calls `gasClient('clearOldData', { sheetsToRestart: ['LiturgicalCalendar', 'Assignments', 'Timeoffs'] })`
- On success: show what was cleared (from response.clearedSheets)

**Final bundle:**
- Run: `cd /home/user/parishliturgyplanner/web && npm run bundle:deploy`
- Verify: `index.html` and `0g_crud_api.gs` exist in `/home/user/parishliturgyplanner/`
- Stage and commit: `web/` (all source), `0f_webapp_api.gs`, `index.html`, `0g_crud_api.gs`, `WEBAPP_PLAN.md`

**Commit message:** `feat: add archive page and bundle web app`

---

## Reference: Shared enums

Used across multiple sheet configs. These are the exact valid values from the codebase:

```
RANKS:              Solemnity, Feast, Sunday, Memorial, Optional Memorial, Weekday
COLORS:             White, Violet, Rose, Green, Red, Gold, Blue, Black
CALENDARS:          General Roman Calendar, USA, Parish
DAYS_OF_WEEK:       Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, Saturday
WEEK_OF_MONTH:      1st, 2nd, 3rd, 4th, 5th, Last
VOLUNTEER_STATUS:   Active, Inactive, Substitute Only, Ministry Sponsor, Parent/Guardian
OVERRIDE_MONTHLY:   append, overrideday
OVERRIDE_YEARLY:    append, override
TIMEOFF_STATUS:     Pending, Approved, Rejected
```

---

## Reference: optionsFrom resolution

Some columns pull their dropdown options from another sheet. The `optionsFrom` property specifies this:

```javascript
optionsFrom: { sheet: 'Ministries', column: 1 }
// Means: fetch Ministries sheet, extract unique values from column index 1 (Role Name, 0-based)

optionsFrom: { sheet: 'WeeklyMasses', column: 0, also: ['MonthlyMasses', 'YearlyMasses'] }
// Means: fetch WeeklyMasses column 0 (Event ID), AND MonthlyMasses column 0, AND YearlyMasses column 0.
// Merge all unique values into one options list.
```

The `also` property is only used on Volunteers → Preferred Mass Time. It merges Event IDs from all three mass config sheets.
