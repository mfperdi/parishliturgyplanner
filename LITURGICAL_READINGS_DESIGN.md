# Liturgical Readings Integration - Design Document

## Executive Summary

This document outlines a design for integrating liturgical reading information into the Parish Liturgical Scheduler. The goal is to provide lectors and liturgy coordinators with reading references for each Mass, making preparation and coordination more efficient.

## Current State Analysis

### Existing Infrastructure

The system already includes:

1. **Liturgical Year Cycle Calculation** (`5_printschedule.gs:469-477`)
   - Automatically determines Sunday Cycle (A, B, C) based on liturgical year
   - Calculates Weekday Cycle (I, II) for weekday readings
   - Already displayed in print schedule headers

2. **LiturgicalCalendar Sheet** (`0a_constants.gs:34-42`)
   - Date, Weekday, Liturgical Celebration, Optional Memorial, Season, Rank, Color
   - 365 rows covering entire year
   - Generated by `CALENDAR_generateLiturgicalCalendar()`

3. **Print Schedule System** (`5_printschedule.gs`)
   - Groups assignments by liturgical celebration
   - Shows rank, season, color for each celebration
   - Already has liturgical year info in header

4. **Assignments Sheet**
   - Links each ministry assignment to a specific Mass and liturgical celebration

### Key Insight

The system **already knows** the liturgical year cycle (A/B/C or I/II) for any given date. This is critical because readings vary by cycle.

---

## Implementation Options

### Option 1: Add Reading Columns to LiturgicalCalendar Sheet

**Structure:** Add 4-5 columns to existing LiturgicalCalendar sheet
- First Reading, Responsorial Psalm, Second Reading, Gospel Acclamation, Gospel

**Pros:**
- ‚úÖ Centralized in one place
- ‚úÖ Easy to integrate with existing code
- ‚úÖ Simple lookup by date

**Cons:**
- ‚ùå Need 3 versions of each row (Cycle A, B, C for Sundays)
- ‚ùå Need 2 versions for weekdays (Cycle I, II)
- ‚ùå Calendar generation becomes 3-5x larger
- ‚ùå Massive data entry burden (365 days √ó 3 cycles = 1095 rows for Sundays alone)

**Verdict:** ‚ùå Not recommended - too much data duplication

---

### Option 2: Create Separate Readings Sheet (Recommended)

**Structure:** New sheet "LiturgicalReadings" with columns:
1. Liturgical Celebration (text key, e.g., "3rd Sunday in Ordinary Time")
2. Cycle (A, B, C, I, II, or "Fixed" for solemnities)
3. First Reading (e.g., "Jonah 3:1-5, 10")
4. Responsorial Psalm (e.g., "Psalm 25:4-5, 6-7, 8-9")
5. Second Reading (e.g., "1 Corinthians 7:29-31")
6. Gospel Acclamation (e.g., "Mark 1:15")
7. Gospel (e.g., "Mark 1:14-20")
8. Notes (alternate readings, optional memorials)

**Pros:**
- ‚úÖ Clean separation of concerns
- ‚úÖ Efficient storage (only store unique celebration + cycle combinations)
- ‚úÖ Easy to update/maintain
- ‚úÖ Can handle all edge cases (alternate readings, optional memorials)
- ‚úÖ No changes to existing calendar generation

**Cons:**
- ‚ö†Ô∏è Requires lookup logic (celebration name + cycle ‚Üí readings)
- ‚ö†Ô∏è Initial data entry required (but one-time and reusable)

**Verdict:** ‚úÖ **Recommended approach**

---

### Option 3: External API Integration (USCCB Lectionary API)

**Structure:** Fetch readings dynamically from USCCB or similar API

**Pros:**
- ‚úÖ No data entry required
- ‚úÖ Always up-to-date
- ‚úÖ Full reading text available (not just references)

**Cons:**
- ‚ùå External dependency (API availability, rate limits)
- ‚ùå Network latency during schedule generation
- ‚ùå Copyright restrictions on full text
- ‚ùå No offline capability
- ‚ùå API may not match parish's liturgical calendar exactly

**Verdict:** ‚ö†Ô∏è Future enhancement, not primary solution

---

### Option 4: Hybrid Approach (Best of Both Worlds)

**Structure:**
1. **Primary:** Readings sheet with reading references (Option 2)
2. **Future:** Optional API integration for full text (Option 3)

**Phased Implementation:**
- **Phase 1:** Create Readings sheet, add lookup logic, integrate with print schedules
- **Phase 2:** Add reading info to assignment notifications (emails to lectors)
- **Phase 3:** Optional API integration for parishes that want full text

**Verdict:** ‚úÖ **Optimal long-term strategy**

---

## Recommended Solution: Readings Sheet Design

### Data Structure

**Sheet Name:** `LiturgicalReadings`

**Columns:**
| Column | Name | Description | Example |
|--------|------|-------------|---------|
| A | Liturgical Celebration | Celebration name (matches LiturgicalCalendar) | "3rd Sunday in Ordinary Time" |
| B | Cycle | A, B, C (Sundays), I, II (Weekdays), or "Fixed" | "B" |
| C | First Reading | Book chapter:verses | "Jonah 3:1-5, 10" |
| D | Responsorial Psalm | Psalm with verses | "Psalm 25:4-5, 6-7, 8-9" |
| E | Second Reading | Book chapter:verses (blank for weekdays) | "1 Corinthians 7:29-31" |
| F | Gospel Acclamation | Reference or text | "Mark 1:15" |
| G | Gospel | Book chapter:verses | "Mark 1:14-20" |
| H | Notes | Alternate readings, options | "Or: Jonah 3:1-10" |

### Sample Data

```
Liturgical Celebration              | Cycle | First Reading    | Resp. Psalm           | Second Reading         | Gospel Accl. | Gospel      | Notes
3rd Sunday in Ordinary Time         | A     | Isaiah 8:23-9:3  | Psalm 27:1, 4, 13-14  | 1 Cor 1:10-13, 17     | Matt 4:23    | Matt 4:12-23|
3rd Sunday in Ordinary Time         | B     | Jonah 3:1-5, 10  | Psalm 25:4-5, 6-7, 8-9| 1 Cor 7:29-31         | Mark 1:15    | Mark 1:14-20|
3rd Sunday in Ordinary Time         | C     | Neh 8:2-4a, 5-6  | Psalm 19:8, 9, 10, 15 | 1 Cor 12:12-30        | Luke 1:1-2   | Luke 1:1-4  | Or: 1 Cor 12:12-14, 27
The Nativity of the Lord (Christmas)| Fixed | Isaiah 52:7-10   | Psalm 98:1-6          | Hebrews 1:1-6         | John 1:1-2   | John 1:1-18 | Daytime Mass
Ash Wednesday                       | Fixed | Joel 2:12-18     | Psalm 51:3-6, 12-14   | 2 Cor 5:20-6:2        | Matt 4:4     | Matt 6:1-6  |
```

### Key Concepts

**Fixed Celebrations:**
- Solemnities, Feasts, Major Holy Days
- Same readings every year regardless of cycle
- Examples: Christmas, Assumption, All Saints Day

**Variable Celebrations:**
- Sundays in Ordinary Time (Cycles A, B, C)
- Weekdays in Ordinary Time (Cycles I, II)
- Most memorials follow weekday cycle

**Edge Cases:**
- **Optional Memorials:** Use weekday readings unless parish celebrates the memorial (check LiturgicalCalendar.OPTIONAL_MEMORIAL column)
- **Vigil Masses:** Usually use readings from following day (system already handles this with `isAnticipated` flag)
- **Special Circumstances:** Weddings, funerals use different lectionary (out of scope)

---

## Implementation Plan

### Phase 1: Core Infrastructure

**1.1 Update Constants** (`0a_constants.gs`)

Add to `CONSTANTS.SHEETS`:
```javascript
READINGS: "LiturgicalReadings"
```

Add to `CONSTANTS.COLS`:
```javascript
READINGS: {
  LITURGICAL_CELEBRATION: 1,
  CYCLE: 2,
  FIRST_READING: 3,
  RESPONSORIAL_PSALM: 4,
  SECOND_READING: 5,
  GOSPEL_ACCLAMATION: 6,
  GOSPEL: 7,
  NOTES: 8
}
```

**1.2 Create Readings Lookup Helper** (new function in `0b_helper.gs`)

```javascript
/**
 * Get liturgical readings for a specific celebration and cycle.
 * @param {string} celebration - Liturgical celebration name
 * @param {string} cycle - Liturgical cycle (A, B, C, I, II, or Fixed)
 * @returns {object} Readings object with all reading references
 */
function HELPER_getReadingsForCelebration(celebration, cycle) {
  try {
    const readingsData = HELPER_readSheetDataCached(CONSTANTS.SHEETS.READINGS);
    const readingsCols = CONSTANTS.COLS.READINGS;

    // Search for matching celebration and cycle
    for (const row of readingsData) {
      const rowCelebration = row[readingsCols.LITURGICAL_CELEBRATION - 1];
      const rowCycle = row[readingsCols.CYCLE - 1];

      if (rowCelebration === celebration) {
        // Fixed celebrations match regardless of cycle
        if (rowCycle === 'Fixed' || rowCycle === cycle) {
          return {
            firstReading: row[readingsCols.FIRST_READING - 1] || '',
            psalm: row[readingsCols.RESPONSORIAL_PSALM - 1] || '',
            secondReading: row[readingsCols.SECOND_READING - 1] || '',
            gospelAcclamation: row[readingsCols.GOSPEL_ACCLAMATION - 1] || '',
            gospel: row[readingsCols.GOSPEL - 1] || '',
            notes: row[readingsCols.NOTES - 1] || ''
          };
        }
      }
    }

    // No readings found
    Logger.log(`No readings found for: ${celebration} (Cycle ${cycle})`);
    return null;

  } catch (e) {
    Logger.log(`Error fetching readings: ${e.message}`);
    return null;
  }
}
```

**1.3 Enhanced Cycle Determination Helper**

```javascript
/**
 * Determine liturgical cycle for a specific date.
 * @param {Date} date - Target date
 * @param {string} celebrationType - 'sunday' or 'weekday'
 * @returns {string} Cycle letter (A, B, C for Sundays; I, II for weekdays)
 */
function HELPER_getLiturgicalCycle(date, celebrationType = 'sunday') {
  // Get liturgical year (Advent-based)
  const liturgicalYear = determineLiturgicalYear([{date: date}]);

  if (celebrationType === 'sunday') {
    // Sunday Cycle: A, B, C
    const remainder = liturgicalYear % 3;
    return remainder === 1 ? 'A' : (remainder === 2 ? 'B' : 'C');
  } else {
    // Weekday Cycle: I (odd years), II (even years)
    return liturgicalYear % 2 === 1 ? 'I' : 'II';
  }
}
```

---

### Phase 2: Integration with Print Schedules

**2.1 Update Print Schedule to Show Readings**

Modify `createCelebrationSection()` in `5_printschedule.gs` to include readings:

```javascript
// After rank info row (around line 657)
if (config.showReadings !== false) {  // Default: show readings
  const cycle = HELPER_getLiturgicalCycle(
    liturgyInfo.dates[0],
    liturgyInfo.dates[0].getDay() === 0 ? 'sunday' : 'weekday'
  );

  const readings = HELPER_getReadingsForCelebration(celebration, cycle);

  if (readings && readings.firstReading) {
    const readingsText = formatReadingsText(readings);

    // Add readings row
    sheet.getRange(currentRow, 1, 1, numColumns).merge();
    sheet.getRange(currentRow, 1).setValue(readingsText);
    sheet.getRange(currentRow, 1)
      .setFontSize(10)
      .setFontStyle('italic')
      .setBackground(bgColor);
    currentRow++;
  }
}

/**
 * Format readings into display text.
 */
function formatReadingsText(readings) {
  let text = `üìñ Readings: ${readings.firstReading}`;

  if (readings.psalm) {
    text += ` ‚Ä¢ Psalm ${readings.psalm}`;
  }

  if (readings.secondReading) {
    text += ` ‚Ä¢ ${readings.secondReading}`;
  }

  if (readings.gospel) {
    text += ` ‚Ä¢ Gospel: ${readings.gospel}`;
  }

  if (readings.notes) {
    text += ` (${readings.notes})`;
  }

  return text;
}
```

**2.2 Add Readings Toggle to Sidebar**

In `Sidebar.html`, add checkbox option:

```html
<div class="form-group">
  <label>
    <input type="checkbox" id="includeReadings" checked>
    Include liturgical readings in schedule
  </label>
</div>
```

Pass to server function:
```javascript
const options = {
  sheetName: sheetName,
  ministryFilter: ministryFilter,
  includeReadings: document.getElementById('includeReadings').checked
};
```

---

### Phase 3: Optional Enhancements

**3.1 Add Reading Column to Assignments Sheet**

- Add "Gospel Reading" column to Assignments sheet (especially useful for lectors)
- Auto-populate during schedule generation
- Shows what each lector will be reading

**3.2 Email Notifications with Readings**

When auto-assigning or sending schedules:
```
Dear John,

You are assigned to proclaim the First Reading at the 10:00 AM Mass on Sunday, January 26, 2025 (3rd Sunday in Ordinary Time, Year B).

Reading: Jonah 3:1-5, 10

Please prepare this reading in advance. May God bless your proclamation of His Word.
```

**3.3 Weekly View Integration**

Add readings to `generateWeeklyView()` function for lector preparation emails.

**3.4 API Integration (Future)**

Add optional integration with USCCB Lectionary API:
- Fetch full text of readings
- Create separate "Full Readings" sheet for lector practice
- Requires API key and proper attribution

---

## Data Population Strategy

### Option A: Manual Entry

**Pros:** Full control, accurate for parish's specific calendar
**Cons:** Time-intensive (but one-time effort)

**Process:**
1. Create template spreadsheet with all Sunday cycles (52 weeks √ó 3 = 156 rows)
2. Add solemnities and major feasts (~40 rows)
3. Add weekday cycles (optional, ~600 rows for complete coverage)
4. Parish staff enters reading references from USCCB website

**Effort:** ~8-12 hours for Sundays and major feasts

---

### Option B: Import from Existing Source

**Pros:** Fast, accurate
**Cons:** Need to find compatible data source

**Potential Sources:**
1. **iBreviary or similar apps** - May have CSV export
2. **Parish liturgy software** - Check if they export lectionary data
3. **Open-source lectionary databases** - Search GitHub, liturgical wikis
4. **USCCB website scraping** - Automated with script (check terms of service)

**Effort:** 2-4 hours to find source + format conversion

---

### Option C: Hybrid Start

**Phase 1:** Enter only Sundays for current liturgical year (~52 rows for one cycle)
**Phase 2:** Add major solemnities and feasts (~30 rows)
**Phase 3:** Gradually add weekdays as needed

**Effort:** ~3-4 hours for immediate usability

---

## Validation and Testing

### Data Validation (`0c_validation.gs`)

Add validation checks:

```javascript
/**
 * Validate LiturgicalReadings sheet.
 */
function VALIDATE_readings() {
  const errors = [];
  const warnings = [];

  try {
    const readingsData = HELPER_readSheetData(CONSTANTS.SHEETS.READINGS);
    const readingsCols = CONSTANTS.COLS.READINGS;

    const seenCombos = new Set();

    for (let i = 0; i < readingsData.length; i++) {
      const row = readingsData[i];
      const celebration = row[readingsCols.LITURGICAL_CELEBRATION - 1];
      const cycle = row[readingsCols.CYCLE - 1];
      const firstReading = row[readingsCols.FIRST_READING - 1];
      const gospel = row[readingsCols.GOSPEL - 1];

      // Check required fields
      if (!celebration || !cycle) {
        errors.push(`Row ${i + 2}: Celebration and Cycle are required`);
      }

      if (!firstReading || !gospel) {
        warnings.push(`Row ${i + 2}: Missing First Reading or Gospel for ${celebration}`);
      }

      // Check for duplicates
      const combo = `${celebration}|${cycle}`;
      if (seenCombos.has(combo)) {
        errors.push(`Row ${i + 2}: Duplicate entry for ${celebration} (Cycle ${cycle})`);
      }
      seenCombos.add(combo);

      // Validate cycle values
      if (!['A', 'B', 'C', 'I', 'II', 'Fixed'].includes(cycle)) {
        errors.push(`Row ${i + 2}: Invalid cycle '${cycle}'. Must be A, B, C, I, II, or Fixed`);
      }
    }

    return { errors, warnings };

  } catch (e) {
    errors.push(`Could not read LiturgicalReadings sheet: ${e.message}`);
    return { errors, warnings };
  }
}
```

### Test Cases

1. **Test reading lookup for known celebration:**
   ```javascript
   const readings = HELPER_getReadingsForCelebration("3rd Sunday in Ordinary Time", "B");
   // Should return Jonah 3:1-5, 10 and Mark 1:14-20
   ```

2. **Test cycle determination:**
   ```javascript
   const cycle = HELPER_getLiturgicalCycle(new Date(2026, 0, 25), 'sunday');
   // Jan 25, 2026 is 3rd Sunday OT in Year B ‚Üí should return "B"
   ```

3. **Test print schedule with readings:**
   - Generate print schedule for January 2026
   - Verify readings appear under each celebration
   - Verify correct cycle is used

---

## Migration and Rollout

### Step 1: Add Infrastructure (No User Impact)
- Create empty LiturgicalReadings sheet
- Add constants and helper functions
- Deploy without enabling readings display

### Step 2: Populate Sample Data
- Add readings for one month (4-5 Sundays)
- Validate with parish staff

### Step 3: Enable for Testing
- Add readings to print schedules (default OFF)
- Allow opt-in via sidebar checkbox
- Gather feedback

### Step 4: Full Rollout
- Complete data entry for full liturgical year
- Enable readings by default
- Update documentation

---

## Documentation Updates

### CLAUDE.md Updates

Add new section:

```markdown
### Workflow 7: Liturgical Readings Integration

**Trigger**: Automatic during print schedule generation

**Data Source**: LiturgicalReadings sheet

**Process**:
1. System determines liturgical cycle (A/B/C or I/II) based on date
2. Looks up reading references in LiturgicalReadings sheet
3. Matches by celebration name + cycle
4. Displays reading references in print schedules

**Reading Types**:
- **Fixed**: Solemnities and major feasts (same every year)
- **Sunday Cycle**: A, B, C (3-year cycle)
- **Weekday Cycle**: I, II (2-year cycle)

**Integration Points**:
- Print schedules (monthly and weekly views)
- Assignment notifications (future enhancement)
- Lector preparation materials (future enhancement)
```

### QUICK_START.md Updates

Add setup step:

```markdown
### Step 8: Liturgical Readings (Optional)

If you want reading references on schedules:
1. Create "LiturgicalReadings" sheet
2. Add column headers: Liturgical Celebration, Cycle, First Reading, Responsorial Psalm, Second Reading, Gospel Acclamation, Gospel, Notes
3. Enter reading data (see LITURGICAL_READINGS_DATA_TEMPLATE.md for sample data)
4. Validate: Admin Tools ‚Üí Validate Data
5. Enable in sidebar when generating print schedules
```

---

## Cost-Benefit Analysis

### Benefits

**For Lectors:**
- ‚úÖ Know what they're reading in advance
- ‚úÖ Can prepare and practice at home
- ‚úÖ Reduces last-minute scrambling

**For Liturgy Coordinators:**
- ‚úÖ Complete schedules with all information needed
- ‚úÖ Easy to distribute via email/print
- ‚úÖ Professional appearance

**For Parish:**
- ‚úÖ Better liturgy preparation
- ‚úÖ More confident lectors
- ‚úÖ Enhanced liturgical formation (people see the readings in advance)

### Costs

**Development Time:**
- Phase 1 (core infrastructure): 4-6 hours
- Phase 2 (print schedule integration): 2-3 hours
- Phase 3 (optional enhancements): 4-8 hours per feature

**Data Entry Time:**
- Sundays only: 3-4 hours (52 weeks √ó 3 cycles)
- Major feasts: 1-2 hours
- Full weekday coverage: 8-12 hours

**Maintenance:**
- Annual review of reading references: 1-2 hours
- Updating for liturgical changes: minimal

### ROI Assessment

**High value for minimal cost** - This feature directly improves core parish operations with manageable one-time setup.

---

## Conclusion

Adding liturgical readings to the Parish Liturgy Planner is **highly feasible** and **high-value** for parishes.

### Recommended Approach

1. **Phase 1:** Implement Readings sheet with lookup logic (4-6 hours development)
2. **Phase 2:** Integrate with print schedules (2-3 hours development)
3. **Data Entry:** Start with Sundays for current year (3-4 hours)
4. **Phase 3:** Expand coverage and add optional enhancements as needed

### Next Steps

1. **Decision:** Approve Phase 1 implementation
2. **Data Source:** Identify where reading data will come from
3. **Pilot:** Test with one month of data
4. **Rollout:** Complete data entry and enable for production use

---

## Appendix: Sample Reading Data Template

See separate file: `LITURGICAL_READINGS_DATA_TEMPLATE.md` (to be created)

Sample rows for common celebrations:

```csv
Liturgical Celebration,Cycle,First Reading,Responsorial Psalm,Second Reading,Gospel Acclamation,Gospel,Notes
1st Sunday of Advent,A,Isaiah 2:1-5,Psalm 122:1-9,Romans 13:11-14,Psalm 85:8,Matthew 24:37-44,
1st Sunday of Advent,B,Isaiah 63:16b-17,Psalm 80:2-3,1 Corinthians 1:3-9,Psalm 85:8,Mark 13:33-37,
1st Sunday of Advent,C,Jeremiah 33:14-16,Psalm 25:4-5,1 Thessalonians 3:12-4:2,Psalm 85:8,Luke 21:25-28,
The Nativity of the Lord (Vigil),Fixed,Isaiah 62:1-5,Psalm 89:4-5,Acts 13:16-17,Matthew 1:18,Matthew 1:1-25,Vigil Mass
The Nativity of the Lord (Night),Fixed,Isaiah 9:1-6,Psalm 96:1-3,Titus 2:11-14,Luke 2:10-11,Luke 2:1-14,Midnight Mass
The Nativity of the Lord (Dawn),Fixed,Isaiah 62:11-12,Psalm 97:1-12,Titus 3:4-7,Luke 2:14,Luke 2:15-20,Dawn Mass
The Nativity of the Lord (Day),Fixed,Isaiah 52:7-10,Psalm 98:1-6,Hebrews 1:1-6,John 1:1-2,John 1:1-18,Daytime Mass
```

---

**Document Version:** 1.0
**Last Updated:** 2025-12-26
**Author:** Claude (AI Assistant)
**Status:** Proposal for Review
